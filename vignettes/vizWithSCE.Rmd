---
title: "vizWithSCE"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{vizWithSCE}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

*vizWithSCE* is an R package that assists with the visualization of the integration of bulk DE results tables with pre-processed scRNA-seq datasets available on Bioconductor.

# Run DESeq2 to obtain bulk DE results

We load gene-summarized RNA-seq counts.

Here we filter to at least 3 samples with a count of 10 or higher.

```{r eval=FALSE}
library(airway)
library(DESeq2)
data(gse)
levels(gse$condition) <- c("untrt", "trt")
dds <- DESeqDataSet(gse, design = ~donor + condition)
keep <- rowSums(counts(dds) >= 10) >= 3
dds <- dds[keep,]
dds <- DESeq(dds)
res <- results(dds)
rownames(res) <- sub("\\..*","",rownames(res))
```

```{r results="hide"}
# the following is evaluated but hidden,
# because the above un-evaluated code chunk
# is slow to run
library(DESeq2)
library(vizWithSCE)
data(dds)
dds <- estimateSizeFactors(dds)
data(res)
```

# Run `integrateWithSingleCell`

We run `integrateWithSingleCell` and pick number 8 from the dataset
selection. 

```{r eval=FALSE}
dat <- integrateWithSingleCell(res, dds)
```

```{r results="hide"}
# the following is evaluated but hidden,
# because the above un-evaluated code chunk
# involves user input.
library(TENxPBMCData)
library(scater)
tenx_pbmc4k <- TENxPBMCData(dataset = "pbmc4k")
sce <- tenx_pbmc4k
dat <- list(res=res, dds=dds, sce=sce)
dat$sce <- logNormCounts(dat$sce)
```

(later we will fix this so that it can be run non-interactively)

# Label cell types or clusters

```{r eval=FALSE}
library(org.Hs.eg.db)
library(SingleR)
library(celldex)
library(scater)
ref <- celldex::BlueprintEncodeData()
dat$sce <- logNormCounts(dat$sce)
sce2 <- dat$sce
rownames(sce2) <- mapIds(org.Hs.eg.db, rownames(sce2), "SYMBOL", "ENSEMBL")
pred <- SingleR(test=sce2, ref=ref, labels=ref$label.main)
table(pred$labels)
colLabels(dat$sce) <- pred$labels
```

```{r results="hide"}
# the following is evaluated but hidden,
# because the above un-evaluated code chunk
# is slow to run
data(labels)
colLabels(dat$sce) <- labels
```

# Use *vizWithSCE* for visualization 

```{r}
library(vizWithSCE)
vizWithSCE(dat, which=2)
```

# Session info

```{r}
sessionInfo()
```
